# 因子开发标准

## 基本要求

1. 因子公式必须使用qlib的语法规范
   - 使用qlib提供的运算符和函数
   - 遵循qlib的表达式规则
   - 参考qlib官方文档中的因子示例

2. 配置文件和参数读取
   ```python
   from factor_inspector import read_corr_params

   # 从配置文件读取相关性分析参数
   instruments, start_time, end_time = read_corr_params("handler_config.yaml")
   ```

3. 因子结果存储规范
   ```python
   # 初始化qlib
   qlib.init(region=REG_CN)

   # 获取因子数据
   df = D.features(instruments, list(factors.values()), start_time, end_time)
   df.columns = factors.keys()

   # 保存到指定路径
   df.to_csv("cache/factor.csv")
   ```

4. 代码注释规范
   ```python
   """
   因子名称：[factor_name]
   因子描述：[detailed_description]
   计算公式：[qlib_formula]

   示例：
   因子名称：VOL5
   因子描述：5日成交量均值
   计算公式：Mean(Volume, 5)
   """
   ```

5. 因子验证流程
   ```bash
   # 使用factor_inspector验证因子相关性
   python factor_inspector.py --corr cache/factor.csv
   ```

## 开发流程

1. 创建新因子文件
2. 编写因子公式（使用qlib语法）
3. 添加完整的注释文档
4. 运行因子计算并保存结果
5. 使用factor_inspector验证因子效果
6. 根据相关性分析结果优化因子

## 注意事项

1. 确保handler_config.yaml中包含正确的配置参数
2. 验证因子时注意观察与现有因子库的相关性
3. 保持因子命名的规范性和可读性
4. 定期更新和维护因子文档
5. 遵循版本控制规范

## 示例代码

```python
from qlib.data import D
import qlib
from qlib.config import REG_CN

# 因子定义
factors = {
    "VOL5": "Mean(Volume, 5)",  # 5日成交量均值
    "MACD": "(Mean(Close, 12) - Mean(Close, 26))",  # MACD指标
}

# 读取配置
instruments, start_time, end_time = read_corr_params("handler_config.yaml")

# 初始化并计算
qlib.init(region=REG_CN)
df = D.features(instruments, list(factors.values()), start_time, end_time)
df.columns = factors.keys()
df.to_csv("cache/factor.csv")
```
